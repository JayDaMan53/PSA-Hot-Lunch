<!DOCTYPE html>

<html>
  <style>
    body {
  min-width: 200px; /* your desired width */
  max-width: 100%;
  position: relative;
  vertical-align: middle;
  border-radius: 1px;
  color: rgb(0, 0, 0);
  transition: background-color 1s;
	  }
	  
	  .rounded-text-box {
  border: 0.5px solid black;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 3px 3px 5px #555;
  color: rgb(0, 0, 0);
  background-color: rgb(255, 255, 255);
  transition: background-color 1s;
	  }

    .rounded-text-box-dark {
  border: 0.5px solid rgb(255, 255, 255);
  border-radius: 10px;
  padding: 10px;
  box-shadow: 3px 3px 5px #555;
  color: #fff;
  background-color: rgb(70, 70, 70);
  transition: background-color 1s;
	  }

    .dark-mode {
  background-color: #000;
  color: #fff;
  transition: background-color 1s;
}

.dark-mode-link {
  color: rgb(0, 229, 254);
  transition: color 1s;
  z-index: 999999999999;
}

.link {
  color: rgb(0, 47, 254);
  transition: color 1s;
  z-index: 999999999999;
}

.Settings {
  position: absolute;
  width: 40px;
  left: 84%;
  top: 92%;
  height: 40px;
  transition: opacity .5s;
}

.Settings:hover {
  cursor: pointer;
}

.SettingsLink {
  text-decoration: underline;
  cursor: pointer;
}

.SandwichClicker {
  border: 0.5px solid black;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 3px 3px 5px #555;
  color: rgb(0, 0, 0);
  background-color: rgb(255, 255, 255);
  position: absolute;
  align-self: center;
  top: 80%;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s, width 1s, background-color 1s;
}

.SandwichClickerOff {
  border: 0.5px solid rgb(255, 255, 255);
  border-radius: 10px;
  padding: 10px;
  box-shadow: 3px 3px 5px #555;
  color: #fff;
  background-color: rgb(70, 70, 70);
  position: absolute;
  align-self: center;
  top: 80%;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s, width 1s, background-color 1s;
}

.SandwichClickerLight {
  border: 0.5px solid black;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 3px 3px 5px #555;
  color: rgb(0, 0, 0);
  background-color: rgb(255, 255, 255);
  position: absolute;
  align-self: center;
  top: 80%;
  opacity: 1;
  transition: opacity 1s, background-color 1s;
  pointer-events: auto;
}

.SandwichClickerDark {
  border: 0.5px solid rgb(255, 255, 255);
  border-radius: 10px;
  padding: 10px;
  box-shadow: 3px 3px 5px #555;
  color: #fff;
  background-color: rgb(70, 70, 70);
  position: absolute;
  align-self: center;
  top: 80%;
  opacity: 1;
  transition: opacity 1s, background-color 1s;
}

.thingy {
  height: 100%;
  width: 100%;
}

  </style>
  <body class="dark-mode">
    <h2 id="Hedether"></h2>
    <h3>By: Jaydon Hall</h3>
    <h3 id="Thedate">Date: loading...</h3>
	  
	<!--<label for="dark-mode-toggle">Dark Mode:</label>  
	<input type="checkbox" id="dark-mode-toggle">-->

  <h3 class="rounded-text-box-dark" id="AB">loading...</h3>
    <h3 class="rounded-text-box-dark" id="Lunch">loading...</h3>
	<h3 class="rounded-text-box-dark" id="next lunch">loading...</h3>
  <!--<div class="SandwichClicker"><b style="font-size: medium; text-decoration: underline;">Achievement Unlocked!</b><br><b style="font-size: medium">Title</b><br><b>Description</b></div>
  <a id="SettingsLink" class="link SettingsLink">Auto Fill Settings</a>-->
  <p></p>
	<a id="Order" class="link" href="https://docs.google.com/forms/d/e/1FAIpQLSf7lnNyFEmRpmOX_0mqx8zwb2q-rCXS-S9X_VPqyRxR3OXQ_w/viewform" target="_blank" rel="noopener noreferrer">
    Order
  </a>  
	<p></p>
	<a id="menu" class="link" href="https://linqconnect.com/public/menu/TXTX8P?buildingId=08d48a65-bba8-ed11-8e6a-c150c5c7a01a" target="_blank" rel="noopener noreferrer" style="z-index: 99999999;">Full Menu</a>
	<p></p>
  <a id="FullAB" class="dark-mode-link" href="https://drive.google.com/file/d/1mFTBCKp56ShO0xLaUl2oyZu9mEQMalmU/view" target="_blank" rel="noopener noreferrer">Full A-B schedule</a>
  <br>
  <br>
	<a href="https://www.youtube.com/@9447V" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/JayDaMan53/PSA-Hot-Lunch/main/Images/Img1.png" alt="Ad" id="ad1" class="thingy"></a>
  <!--<img id="Settings" class="Settings" src="Logos/Settings.png">-->
  <script>
	  function getBusinessDays(startDate, endDate) {
	let days = 0;
	let currentDate = new Date(startDate);
	while (currentDate <= endDate) {
	  let dayOfWeek = currentDate.getDay();
	  if (dayOfWeek !== 0 && dayOfWeek !== 6) {
		days++;
	  }
	  currentDate.setDate(currentDate.getDate() + 1);
	}
	return days;
  }
  const date = new Date();
  let endDate = new Date('2025-05-30');
  let businessDays = getBusinessDays(date, endDate);

let day = date.getDate();
let month = date.getMonth();

async function getdata() {
    const url1 = 'https://raw.githubusercontent.com/JayDaMan53/PSA-Hot-Lunch/main/lunch_schedule_data.txt';
    try {
        const response = await fetch(url1);
        const data = await response.text();

        // Execute the fetched JavaScript code
        //eval(data);
		console.log(data)
		//return [lunchList, AB_Schedule]
		return data
    } catch (error) {
        console.error('Failed to fetch or execute data:', error);
    }
}

async function main() {
    try {
        // Assuming getdata is a function that returns a promise
        const data = await getdata(); // Wait for getdata to finish
		const lines = data.split('\n');
		const lunchList = {};
		const AB_Schedule = {};
		let imgLink = ""; // Initialize imgLink as an empty string
		let version = ""; // Initialize version as an empty string
		let currentObject = null;

		lines.forEach(line => {
			if (line.startsWith('lunchList = {')) {
				currentObject = lunchList;
			} else if (line.startsWith('AB_Schedule = {')) {
				currentObject = AB_Schedule;
			} else if (line.match(/^\s+\d+: {/)) { // New sub-object
				const key = line.match(/^\s+(\d+): {/)[1];
				currentObject[key] = {};
			} else if (line.match(/^\s+\d+: ".+"/)) { // Key-value pair
				const matches = line.match(/^\s+(\d+): "(.+)"/);
				const key = matches[1];
				const value = matches[2];
				const lastKey = Object.keys(currentObject)[Object.keys(currentObject).length - 1];
				currentObject[lastKey][key] = value;
			} else if (line.startsWith('imgLink = "')) { // imgLink assignment
				imgLink = line.match(/^imgLink = "(.+)"/)[1];
			} else if (line.startsWith('version = "')) { // version assignment
				version = line.match(/^version = "(.+)"/)[1];
			}
		});

		console.log('Lunch List:', lunchList);
		console.log('AB Schedule:', AB_Schedule);
		console.log('Image Link:', imgLink); // Log the imgLink
		console.log('Version:', version); // Log the version

		/*/if (imgLink == "") {
			document.getElementById("ad1").remove()
		} else {
			//document.getElementById("ad1").herf = imgLink
		}

		var manifestData = chrome.runtime.getManifest();
		if (manifestData.version != version) {
			Award("Extension out of date!", "There is eather a new update out or a new update is on the way!", 10000, true)
		}/*/

        let monthNAMES = ["Jan.", "Feb.", "March", "April", "May", "June", "July", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."]; document.getElementById("Hedether").innerHTML = "Lunch for " + monthNAMES[month];

		document.getElementById("Thedate").innerHTML = (month + 1) + "/" + day + "/" + date.getFullYear()

		document.getElementById("Lunch").innerHTML = "Todays hot-lunch: " + lunchList[month][day];
		document.getElementById("next lunch").innerHTML = "Tomorrow's hot-lunch: " + lunchList[month][day + 1];

		if (lunchList[month][day] == undefined) {
			document.getElementById("Lunch").innerHTML = "Todays hot-lunch: N/A"
		}
		if (lunchList[month][day + 1] == undefined) {
			document.getElementById("next lunch").innerHTML = "Tomorrow's hot-lunch: N/A"
		}

		if (AB_Schedule[month][day] == "Leap") {
			document.getElementById("AB").innerHTML = "Today is a Leap day!"
		} else if (AB_Schedule[month][day] == "A Weekend") {
			if (AB_Schedule[month][day + 1] != "A Weekend") {
				if (AB_Schedule[month][day + 1] == "A") {
					document.getElementById("AB").innerHTML = "Today is a Weekend! <br> Tomorrow is an A day!"
				} else if (AB_Schedule[month][day + 1] == "B") {
					document.getElementById("AB").innerHTML = "Today is a Weekend! <br> Tomorrow is a B day!"
				} else {
					if (AB_Schedule[month][day + 1]) {
						document.getElementById("AB").innerHTML = "Today is a Weekend! <br> Tomorrow is " + AB_Schedule[month][day + 1] + "!"
					} else {
						document.getElementById("AB").innerHTML = "Today is a Weekend!"
					}
				}
			} else {
				document.getElementById("AB").innerHTML = "Today is a Weekend!"
			}
		} else {
			if (AB_Schedule[month][day] == "A") {
					document.getElementById("AB").innerHTML = "Today is an A day!"
				}
				else if (AB_Schedule[month][day] == "B") {
					document.getElementById("AB").innerHTML = "Today is a B day!"
				}
				else if (AB_Schedule[month][day] == "C") {
					document.getElementById("AB").innerHTML = "Today is a C day!"
			} else {
				document.getElementById("AB").innerHTML = "Today is " + AB_Schedule[month][day] + "!"
			}
		}

		if (AB_Schedule[month][day] == undefined) {
			document.getElementById("AB").innerHTML = "Error loading..."
		}
    } catch (error) {
        console.error('An error occurred:', error, error.line);
    }
}

main(); // Don't forget to call the main function
  </script>
  </body>
</html>
